"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6806],{851853:function(e,n,t){t.r(n),t.d(n,{OneTapAuth:function(){return R},useOneTapAuth:function(){return A}});var o={};t.r(o),t.d(o,{loginErrorMsgs:function(){return b}});var r=t(713070),a=t(870751),i=t(272374),s=t(545002),c=t(752406);const u={mediation:"required",password:!0},l=()=>window.navigator.credentials.get(u);var g=t(147584);const p=e=>{let{type:n,pageInfo:t}=e;if("log"===n||"metric"===n)return"walmartWeb";const{pathname:o}=t,r="query"in t?t.query.step:new URLSearchParams(t.search).get("step");if("cart"===r)return"shoppingCart";if("bookslot"===r)return"bookSlot";if("/"===o)return"homePage";switch(o.split("/")[1]){case"all-departments":return"browse";case"lists":case"my-items":case"my-registries":case"registry":return"myItems";case"survey":return"fulfillmentSurvey";case"thankyou":return"thankYouPage";case"search":return"searchResults";case"cart":return"shoppingCart";case"account":return"query"in t&&"spotify"===t.query.code?"spotifyDetailPage":"query"in t&&"cashback"===t.query.code?"cashbackBenefitOverview":"query"in t&&"paramount"===t.query.code?"paramountDetailPage":"account";case"browse":return"browseResults";case"tp":case"topic":case"c":return"topicPage";case"help":return"help";case"ip":case"product":case"reviews":return"itemPage";case"orders":return o.includes("/edit")?"amends":o.includes("/returns")?"returns":o.includes("/track-live")?"liveOrderTracking":o.includes("/track")?"orderTracking":o.includes("/cancel")?"cancellation":o.includes("/shopper-substitutions")?"orderUpdates":o.match(/\/orders\/\d{13,15}/i)?"orderDetails":o.includes("/get-help")?"getHelp":"yourOrders";case"plus":return o.includes("/program")?"wplusOfferDetails":"wplus";case"partner":return o.includes("/promo-code")?"redeemMembershipPartnershipPromo":o.includes("/confirmation")?"redeemMembershipPartnershipPromoSuccess":"query"in t&&"spotify"===t.query.code?"spotifyLandingPage":"partnershipLandingPage";case"seller":return"sellerPage";case"deals":case"shop":return"shop";case"cp":case"content":return"contentPage";case"store":return"storeMode"}return""},d=()=>{const e=(()=>{const e=(0,g.wG)();return(n,t,o,r,a,i)=>{e({context:a||"account",action:o||"asyncEvent",name:i,payload:{ta:{pt:i},sa:{st:n},nm:{nm:t},vr:{ft:r}}})}})(),n=(()=>{const e=(0,g.wG)();return(n,t,o,r,a,i)=>{if("string"===typeof t){const e=[];e.push({ms:o,lc:i,ty:t,ft:r||""}),t=e}e({context:a||"account",action:"error",name:n,payload:{ta:{pt:i},nm:{nm:"signInFailure"},er:t}})}})(),{router:t}=(0,i.t)(),o="/account/login"===t.pathname;return{oneTapAsyncBeacon:(n,r,a)=>e(n,r,a,"oneTapSignin",o?"account":p({type:void 0,pageInfo:t}),o?"enterYourEmailToSignInOrCreateAnAccount":p({type:void 0,pageInfo:t})),oneTapErrorBeacon:(e,r,a)=>n(e,r,a,"oneTapSignin",o?"account":p({type:void 0,pageInfo:t}),o?"enterYourEmailToSignInOrCreateAnAccount":p({type:void 0,pageInfo:t}))}};var m=t(818102),f=t(332747),h=t(930416),w=t(35968);const y={type:"mutation",name:"SignIn",query:"mutation SignIn($input:SignInInput! $includeLoginOptions:Boolean = false){signIn(input:$input){auth{loginId authCode}errors{...SignInErrorFragment}loginOptions @include(if:$includeLoginOptions){...LoginOptionsFragment}}}fragment SignInErrorFragment on IdentitySignInError{code message}fragment LoginOptionsFragment on LoginOptions{loginId canUsePassword canUsePhoneOTP canUseEmailOTP loginPhoneLastFour signInPreference loginPreference lastLoginPreference}",hash:"80f8c17407afe1fcd1b75b743023f9e1a6ac3ded28d3ac807d4923f37eddfe39"};var O=t(279678),P=t(637563),v=t(145293);const I=(e,n)=>{const t=["/account/signin","/account/signin/otponly","/account/login","/account/signin/withotpchoice","/account/signin/withpassword","/account/signup","/account/verifyitsyou","/account/verifyyouraccount","/account/forgotpassword","/account/resetpassword","/account/skipresetpassword"],{vidParam:o,showWPlusSplashScreenParam:r,modeParam:a,envParam:i,scopeParam:s,redirectUriParam:c,clientIdParam:u,nonceParam:l,stateParam:g}=(0,O.vl)();let p="";if(s&&c&&u&&l)p=S(n,s,c,u,l,g);else{if("/account/login"===n){var d,m,f;const{signInPathname:e}=(null==(d=(0,v.default)())||null==(m=d.publicRuntimeConfig)||null==(f=m.identity)?void 0:f.context)||P.Of;n=e}const s=n+"?vid="+(o||("B2C"===e?"oaoh":e.toLowerCase()))+"&tid=0"+(a?"&mode="+a:"")+(r?"&showWPlusSplashScreen="+r:"")+(i?"&env="+i:""),c=new URLSearchParams(location.search).get("returnUrl"),u=c?"&returnUrl="+encodeURIComponent(c):"&returnUrl="+encodeURIComponent("/");if(t.includes(location.pathname))return""+s+u+location.hash;const l=""+location.pathname+location.search+location.hash;p=s+"&returnUrl="+encodeURIComponent(l)}return p},S=(e,n,t,o,r,a)=>""+(e+"?"+("scope="+n)+("&redirect_uri="+t)+("&client_id="+o)+("&nonce="+r)+(a?"&state="+a:""));let T;!function(e){e.PASSWORD="/account/signin/withpassword",e.PHONE_OTP="/account/signin/otponly",e.OTP="/account/signin/otponly",e.CHOICE="/account/signin/withotpchoice",e.CREATE="/account/signup"}(T||(T={}));var E=t(84505),C=t(546682),L=t(374436);const b=e=>{let{errorCode:n}=e;return"LOCKED"===n?"Your account has been temporarily locked due to too many failed sign-in attempts. Please try again after 30 minutes or ":"DISABLED"===n?"This account has been closed. Please refer to the email we sent for more details.":"COMPROMISED"===n?"We have reset your password as a security measure. Enter your email to continue.":"USER_AUTH_FAIL"===n?"Your password and email do not match. Please try again or Reset your password.":"STEP_UP_REQUIRED"===n?"To continue, you'll need to confirm it's you by entering a verification code.":"Something went wrong, please try again."},U=()=>{const{oneTapAsyncBeacon:e,oneTapErrorBeacon:n}=d(),{redirectOnAuthSuccess:t}=(0,f.Eu)(),i=(0,a.iC)(r.K),s=(e,n)=>{if(n){const e=new Date;e.setTime(e.getTime()+9e5),document.cookie="compromised=true;secure=true;domain=.walmart.com;path=/;samesite=lax;expires="+e.toUTCString()+";"}document.cookie=(0,m.pC)(e,15),window.location.assign(I("B2C","/account/forgotpassword"))},{setValue:c}=(0,L.Xs)("oneTapError"),{setValue:u}=(0,L.Xs)("userInfo"),[l]=(e=>{const n=(0,h.G)("cegateway");return(0,w.Db)((e=>n(y,e)),e)})({onSuccess:(r,a)=>{var l,g;const p=null==r||null==(l=r.data)?void 0:l.signIn;if(null!=p&&null!=(g=p.errors)&&g.length){var d,m,f;const t={email:null==a||null==(d=a.input)?void 0:d.email,loginPhoneLastFour:(null==(m=p.loginOptions)?void 0:m.loginPhoneLastFour)||null};u(t);const r=(null==(f=p.errors[0])?void 0:f.code)||"SOMETHING_WENT_WRONG",l=(0,E.m)(o,"loginErrorMsgs",{errorCode:r.toString()}),g={code:r,msg:l};if(e("signInFailure",r,"error"),"FYP_REQUIRED"===r)s(a.input.email);else if("COMPROMISED"===r)s(a.input.email,!0);else if("STEP_UP_REQUIRED"===r)window.location.assign(I("B2C","/account/verifyitsyou"));else if("PASSWORD_NOT_ALLOWED"===r)window.location.assign(I("B2C",T.OTP));else if("USER_AUTH_FAIL"===r){var h,w,y;const e={canUsePhoneOTP:(null==(h=p.loginOptions)?void 0:h.canUsePhoneOTP)||null,canUseEmailOTP:null==(w=p.loginOptions)?void 0:w.canUseEmailOTP,lastLoginPreference:(null==(y=p.loginOptions)?void 0:y.lastLoginPreference)||null};u({...t,...e}),c(g),p.loginOptions?((e,n,t)=>{var o,r;let a="";var s;a=(null==(o=i.identity.values)?void 0:o.enableEmailOtpPhoneAvailable)||(null==(r=i.identity.values)?void 0:r.enableEmailOtpPhoneNotAvailable)?"CHOICE"!==t||null!=(s=i.identity.values)&&s.enableEmailOtpPhoneNotAvailable||n?T[t]:T.PASSWORD:"PASSWORD"===e&&n?T.CHOICE:T[e],window.location.assign(I("B2C",a))})(p.loginOptions.signInPreference,p.loginOptions.loginPhoneLastFour,p.loginOptions.loginPreference):(0,C.cM)(["error","identity-next","signInToYourWalmartAccount","signInMutation OneTapSignIn"],{type:"log",message:"No loginOptions received",customStatusCode:"OneTapSignIn_Error"})}else(0,C.cM)(["error","identity-next","signInToYourWalmartAccount","signInMutation OneTapSignIn"],{type:"log",message:r,customStatusCode:r}),n("error",null==l?void 0:l.toLowerCase(),null==l?void 0:l.toLowerCase()),c(g),window.location.assign(I("B2C","/account/login"))}else(()=>{if(e("success","oneTapSignin","asyncEvent"),(0,L.L_)("userInfo"),(0,L.L_)("oneTapError"),"/account/login"===window.location.pathname){var n;t(!0,null==(n=i.identity.values)?void 0:n.identityNextTenants,!0)}else{const e=new URL(window.location.href),n={action:"SignIn",rm:"true"};for(const[t,o]of Object.entries(n))e.searchParams.append(t,o);window.location.assign(e.toString())}})()},onError:e=>{e.message&&(0,C.cM)(["error","identity-next","signInToYourWalmartAccount","signInMutation OneTapSignIn"],{type:"log",message:e.message,customStatusCode:"OneTapSignIn_Error"}),c({code:"SOMETHING_WENT_WRONG",msg:(0,E.m)(o,"loginErrorMsgs",{errorCode:"SOMETHING_WENT_WRONG"})}),window.location.assign(I("B2C","/account/login"))}});return{signIn:l}},A=()=>{var e,n;const{oneTapAsyncBeacon:t}=d(),{router:o}=(0,i.t)(),{signIn:u}=U(),g=(0,a.iC)(r.K),p=(null==(e=g.identity.values)?void 0:e.enableOneTapSignIn)||!1,m=(null==(n=g.identity.values)?void 0:n.oneTapOptOutExpireTime)||36e5,f="/account/login"===o.pathname;return{showOneTapAuth:(0,c.useCallback)((()=>{const e=Date.now();let n=!1;const o=(0,s.D)("oneTapSession");if(o){const{optOut:t,optOutTimestamp:r}=o;n=!(e-r>m||f)&&t}n||(t("success","oneTapSignin","overlayView"),(async e=>{let{oneTapEnabled:n,onCredPresent:t,onCredMissing:o,onOneTapError:r,getCredentials:a=l}=e;if(n)try{const e=await a();if(e&&t)return t(e);if(!e&&o)return o()}catch(i){r&&r(i)}Promise.resolve(!1)})({oneTapEnabled:p,onCredPresent:e=>{const{id:n,password:o}=e;t("success","oneTapSignin","onClick"),u({input:{email:n,password:o,rememberMe:!0},includeLoginOptions:!0})},onCredMissing:()=>{if(!f){const n={optOut:!0,optOutTimestamp:e};(0,s.c)("oneTapSession",n)}t("success","oneTapSigninCancel","onClick")},onOneTapError:e=>{let n="oneTapSignin failed";e instanceof Error&&(n=e.message),t("signInFailure",n,"error")}}))}),[p,f,m])}},R=()=>{var e;const{authState:n}=(0,f.Eu)(),{showOneTapAuth:t}=A(),{isPageInAllowList:o}=(()=>{var e,n;const t=null!=(e=null==(n=(0,a.iC)(r.K).identity.values)?void 0:n.oneTapAllowList)?e:"/,/ip,/search,/browse";return{isPageInAllowList:(0,c.useCallback)((e=>t.replace(/\s/g,"").split(",").some((n=>"/"===n?e===n:e.startsWith(n)))),[t])}})(),i=(null==(e=(0,a.iC)(r.K).identity.values)?void 0:e.enableOneTapSignInLandingPages)||!1;return(0,c.useEffect)((()=>{o(window.location.pathname)&&i&&!n.isLoggedIn&&t()}),[i,n.isLoggedIn,t,o]),null}},818102:function(e,n,t){t.d(n,{JA:function(){return c},nx:function(){return i},pC:function(){return s}});var o=t(752406),r=t(442794),a=t(330567);const i=()=>{const e="guestCU";(0,r.ej)(e)&&(0,r.nJ)(e,{domain:".walmart.com"})},s=(e,n)=>{const t=new Date;return t.setTime(t.getTime()+60*n*1e3),"guestCU="+e+";secure=true;domain=.walmart.com;path=/;samesite=lax;expires="+t.toUTCString()+";"},c=e=>class extends o.Component{constructor(e){super(e);const{guestInfo:n,mode:t}=e;(e=>{let n="";if((e=>"gxoSignup"===e.mode)(e)){const{email:t,firstName:o,lastName:r}=e;n=encodeURIComponent(t+":"+o+":"+r)}else n=encodeURIComponent(""+e.email);document.cookie=s(n,15)})({...n,mode:t})}render(){return(0,a.jsx)(e,{...this.props})}}},930416:function(e,n,t){t.d(n,{G:function(){return r}});var o=t(855124);const r=function(){const{getGqlFetch:e}=(0,o.Z)();return e(...arguments)}},374436:function(e,n,t){t.d(n,{L_:function(){return a},Pi:function(){return i},Xs:function(){return r},l7:function(){return s}});var o=t(546682);const r=e=>({setValue:n=>{try{return window.top.sessionStorage.setItem(e,JSON.stringify(n)),!0}catch(t){return!1}},getValue:()=>{let n=null;try{return n=window.top.sessionStorage.getItem(e),n?JSON.parse(n):null}catch(t){return null}}}),a=e=>{try{return window.top.sessionStorage.removeItem(e),!0}catch(n){return!1}},i=e=>{if(!window.sessionStorage)return null;try{return window.sessionStorage.getItem(e)}catch(n){return(0,o.cM)(["error","platform","session-storage","safeGetSessionStorageItem"],n),null}},s=(e,n)=>window.sessionStorage&&window.sessionStorage.setItem(e,n)}}]);