"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[42710],{865723:function(e,t,n){n.d(t,{e:function(){return A}});var a=n(494406),i=n(860960),s=n(870751),r=n(869193),o=n(855124),d=n(35968),l=n(696208),u=n(181739),c=n(46674),m=n(151918);const g=(e,t)=>{let{timeoutMs:n,loggingEnable:a,isMobile:i}=t;return{queryFn:()=>(0,l.qB)(e.getGqlFetch((0,u.d)(i),{timeoutMs:n})(m.T,{input:{exclude:["RL","PL","ML","CL"]}}),{apiName:"shoppingListsExtended",queryKey:[c.Je,"add-items"],loggingEnable:a},!0),queryKey:[c.Je,"add-items"]}};var p=n(588878),f=n(508548),h=n(553815);var I=(0,p.o)([f.Hi.TAGS.TRANSFORM_FAILURE],(e=>{var t;return null!=e&&null!=(t=e.shoppingListsExtended)&&t.lists?e.shoppingListsExtended.lists.map((e=>{var t;if(!e)return{id:"",name:"",type:"",ownerName:"",recentItemImage:"",recentItemName:"",showPrimary:!1,maxItemsReached:!1};const{product:n,secondaryProduct:a}=e.recentItem?{product:e.recentItem.product,secondaryProduct:e.recentItem.secondaryProduct}:{product:{imageInfo:{thumbnailUrl:""},name:""},secondaryProduct:{imageWhenAdded:"",nameWhenAdded:""}},{ownerDetails:i}=e,s=i.caller;return{id:e.id,name:e.name,type:e.type,ownerName:s?"":i.firstName+" "+i.lastName,recentItemImage:n.imageInfo.thumbnailUrl||a&&a.imageWhenAdded||h.r1,recentItemName:null!=(t=n.name)?t:a.nameWhenAdded,showPrimary:e.primary,maxItemsReached:e.maxItemsReached}})):[]}));var w=()=>{var e,t;const n=(0,o.Z)(),{isMobile:a}=(0,r.vP)(),{timeoutMs:l,loggingEnable:u}=(0,s.iC)(i._).list.values||{},{data:c,isLoading:m,isFetching:p,error:f,refetch:h,isStale:w}=(0,d.aM)({...g(n,{timeoutMs:l,loggingEnable:u,isMobile:a}),config:{enabled:!1,refetchOnWindowFocus:!1,staleTime:1/0}}),y=p||m;return{errorMessageGetAllLists:f&&f.message||"",isStale:w,lists:I(null==c?void 0:c.data),maxListsReached:!(null==c||null==(e=c.data)||null==(t=e.shoppingListsExtended)||!t.maxListsReached),refetch:h,showSpinner:y}},y=n(739333),L=n(84505),b=n(715963),x=n(536486),P=n(284420),v=n(407469),M=n(385909),C=n.n(M),S=n(752406),E=n(609011),H=n(330567);const N=C()((()=>Promise.all([n.e(69902),n.e(6086)]).then(n.bind(n,794560))),{ssr:!1,loading:()=>(0,H.jsx)(P.Z,{}),loadableGenerated:{webpack:()=>[794560]}}),R=C()((async()=>(await Promise.all([n.e(69902),n.e(49774),n.e(91540),n.e(64622),n.e(53246),n.e(66789),n.e(30848),n.e(17123),n.e(89475),n.e(68800)]).then(n.bind(n,579846))).MaxLimitPage),{ssr:!1,loading:()=>(0,H.jsx)(P.Z,{}),loadableGenerated:{webpack:()=>[579846]}}),A=e=>{let{addItemToListPage:t="Add item to list",analyticsDetails:n,isOpen:i,isSaving:s,onSaveClick:o,setIsOpen:d,createListPage:l}=e;const{0:u,1:c}=(0,S.useState)({id:"",name:"",type:"",ownerName:"",maxItemsReached:!1}),{isMobile:m}=(0,r.vP)(),g=(0,S.useRef)(u.id),p=(0,S.useRef)(""),f=(0,S.useRef)(!1),h=(0,S.useRef)(!1),I=(0,a.Z)(),{errorMessageGetAllLists:M,isStale:C,lists:A,maxListsReached:k,refetch:T,showSpinner:U}=w();(0,S.useEffect)((()=>{I&&(f.current=I)}),[I,u]),(0,S.useEffect)((()=>{g.current!==u.id&&f.current&&(h.current=!0)}),[g,u]),(0,S.useEffect)((()=>{!u.id&&A.length&&c(A[0])}),[A,u.id]),(0,S.useEffect)((()=>{i&&(C||M)&&T()}),[i,M,C,T]),(0,S.useEffect)((()=>{i||!u.id||u.maxItemsReached||u.id===A[0].id||c(A[0])}),[i,u.id,u.maxItemsReached,A]);const D=()=>{d(!i),p.current&&(p.current=""),f.current&&i&&(f.current=!1)},q={addItemToListPageContentKey:{pageTitle:t,component:e=>{let{setPage:t}=e;return(0,H.jsx)(N,{analyticsDetails:n,errorMessageGetAllLists:M,allowRadioNav:!f.current||h.current,maxListsReached:k,lists:A,showSpinner:U,selectedList:u,selectList:c,setPage:t,prevPageRef:p})},titleCustomClass:m?{backButton:"dn"}:{backButton:"dn",titleCont:"ml2-m",title:"tl-m"}},createListContentKey:{pageTitle:(0,L.m)(E,"createList"),component:l,titleCustomClass:{backButton:"pointer"}},maxListsLimitContentKey:{pageTitle:(0,L.m)(E,"newListError"),component:e=>{let{onWrappedClose:t}=e;return(0,H.jsx)(R,{maxModalMessage:(0,L.m)(E,"maxLists"),onWrappedClose:t})},titleCustomClass:{backButton:"pointer"}},maxItemLimitContentKey:{pageTitle:(0,L.m)(E,"itemListError"),component:e=>{let{onWrappedClose:t}=e;return(0,H.jsx)(R,{maxModalMessage:(0,L.m)(E,"maxListItems"),onWrappedClose:t})},titleCustomClass:{backButton:"pointer"}}};return(0,H.jsxs)(H.Fragment,{children:[U&&(0,H.jsx)(P.Z,{}),(0,H.jsx)(x.Z,{children:(0,H.jsx)(v.Z,{getActionButton:(e,t)=>"addItemToListPageContentKey"===t&&!M&&(0,H.jsx)(b.Z,{isFullWidth:!0,onClick:()=>{o({setPage:e,selectedList:u,toggleOpen:D})},onLinkExtras:n.onListSelect(u),onLinkName:"save",size:"medium",variant:"primary",disabled:u.maxItemsReached&&s,leading:u.maxItemsReached&&s&&(0,H.jsx)(y.Spinner,{color:"white",size:"small",a11yLabel:(0,L.m)(E,"savingList")}),children:(0,L.m)(E,"save")}),initialPage:"addItemToListPageContentKey",isOpen:i&&!U,onClose:D,pageScope:q,showTransitionGradient:!1})})]})}},381119:function(e,t,n){n.d(t,{Z:function(){return y}});var a=n(860960),i=n(740017),s=n(43020),r=n(739333),o=n(870751),d=n(84505),l=n(869193),u=n(147584),c=n(35968),m=n(855124),g=n(272374),p=n(658597),f=n(46674),h=n(696208),I=n(181739);const w={type:"mutation",name:"addItemToListLite",query:"mutation addItemToListLite($input:AddListItemLiteInput!){addItemToListLite(input:$input){id}}",hash:"9ba1253e682b673b597549601a886e80538592e8035f3e182ddb294b66342da5"};var y=e=>{const t=(0,c.Zq)(),{isMobile:n}=(0,l.vP)(),{router:y}=(0,g.t)(),L=(0,m.Z)(),b=(0,u.wG)(),{cacheUpdated:x,cid:P,idbStore:v}=(0,i.K)(),{addSnack:M}=(0,r.useSnackbar)(),C=(0,o.iC)(a._),{timeoutMs:S=0,loggingEnable:E}=C.list.values||{},{mutationFn:H}=((e,t)=>{let{timeoutMs:n,loggingEnable:a,isMobile:i}=t;return{mutationFn:t=>(0,h.qB)(e.getGqlFetch((0,I.d)(i),{timeoutMs:n})(w,t),{apiName:"addItemToListLite",gqlVariables:t,loggingEnable:a},!0)}})(L,{timeoutMs:S,loggingEnable:E,isMobile:n});return(0,c.Db)(H,{onSuccess:(n,a)=>{let{input:{items:i,listId:r},name:o,type:l,ownerName:u,maxItemsReached:c,toggleOpen:m,showPrimary:g,shouldInvalidateAllCache:h=!0}=a;c&&m(!0);(g||"FL"===l)&&((0,s.IH)(i[0].usItemId,P,v),x());const I={name:o,type:l,ownerName:u,id:r},w=e.addItemsSuccess(I);b({context:e.context,action:"moduleView",name:"addedToList",payload:w}),h&&(t.invalidateQueries(f.Je),t.invalidateQueries(f.Ht),M({message:(0,d.m)(p,"snackbarSave",{name:o}),actionButtonProps:{children:(0,d.m)(p,"viewList"),onClick:()=>{const t=e.viewClick(I);b({context:e.context,action:"onLink",name:"viewList",payload:t}),y.push("/lists/"+l+"/"+r)}}}))},onError:(e,t)=>{let{setPage:n,handleError:a}=t;"LSE-4054"===e.name?n("maxItemLimitContentKey"):a()}})}},494406:function(e,t,n){var a=n(752406);t.Z=()=>{const e=(0,a.useRef)(!0);return(0,a.useEffect)((()=>{e.current=!1}),[]),e.current}},151918:function(e,t,n){n.d(t,{T:function(){return r},U:function(){return o}});var a=n(696208),i=n(181739),s=n(46674);const r={type:"query",name:"getAllLists",query:"query getAllLists($input:ShoppingListsInput){shoppingListsExtended(input:$input){maxListsReached lists{...f_lists}}}fragment f_lists on ShoppingList{id name type lineItemCount primary ownerDetails{firstName lastName caller}recentItem{product{imageInfo{thumbnailUrl}name}secondaryProduct{imageWhenAdded nameWhenAdded}}maxItemsReached}",hash:"bb8e841a10666e2e7d768bf645847fcda41094eb00be5ec4a2fea482fa8d4f00"},o=(e,t)=>{let{disableAuthFetch:n=!0,timeoutMs:o,loggingEnable:d,isMobile:l}=t;return{queryFn:()=>(0,a.qB)(e.getGqlFetch((0,i.d)(l),{disableAuthFetch:n,timeoutMs:o})(r),{apiName:"shoppingListsExtended",queryKey:[s.Je,"all-lists"],loggingEnable:d},!0),queryKey:[s.Je,"all-lists"]}}},339658:function(e,t,n){n.d(t,{a:function(){return i}});var a=n(442794);const i=()=>(0,a.ej)("CID")||""},43020:function(e,t,n){n.d(t,{F$:function(){return r},FN:function(){return L},IH:function(){return f},MT:function(){return d},ND:function(){return w},No:function(){return p},Nu:function(){return b},Nx:function(){return m},Od:function(){return h},To:function(){return y},YI:function(){return v},oT:function(){return P},pg:function(){return x},s_:function(){return u},sq:function(){return g},wJ:function(){return c},zS:function(){return I}});var a=n(575393);const i={usItemIds:[],pendingHearts:[],pendingUnHearts:[],pendingGetAllItems:!1,lastPending:0,lastModified:0},s=6e4,r="heart-",o=e=>""+r+e,d=()=>new a.yh("lists-hearting-hearts","hearts"),l=async(e,t)=>{if(!t)return i;const n=await(0,a.U2)(o(e),t)||i;return{...i,...n,usItemIds:n.usItemIds||i.usItemIds,pendingHearts:n.pendingHearts||i.pendingHearts,pendingUnHearts:n.pendingUnHearts||i.pendingUnHearts}},u=async(e,t,n)=>{if(!n)return;const i={...await l(t,n),usItemIds:e,lastModified:Date.now()};await(0,a.t8)(o(t),i,n)},c=async(e,t)=>{if(!t)return;const n={...await l(e,t),usItemIds:[],lastModified:0};await(0,a.t8)(o(e),n,t)},m=async(e,t)=>{const n=await l(e,t),a=n.usItemIds.concat(n.pendingHearts).filter((e=>!n.pendingUnHearts.includes(e)));return[...new Set(a)]},g=async(e,t,n)=>{const a=(await l(e,n)).lastModified+t;return Date.now()<=a},p=async(e,t,n)=>(await m(t,n)).includes(e),f=async(e,t,n)=>{if(!n)return;const i=await l(t,n);i.usItemIds.includes(e)||await(0,a.t8)(o(t),{...i,usItemIds:[...i.usItemIds,e]},n)},h=async(e,t,n)=>{if(!n)return;const i=await l(t,n),s=i.usItemIds.filter((t=>t!==e));await(0,a.t8)(o(t),{...i,usItemIds:s},n)},I=async(e,t)=>{const n=await l(e,t);return Date.now()-n.lastPending<s?n.pendingHearts:i.pendingHearts},w=async(e,t,n)=>{if(!n)return;const i=await l(t,n);i.pendingHearts.includes(e)||await(0,a.t8)(o(t),{...i,pendingHearts:[...i.pendingHearts,e],lastPending:Date.now()},n)},y=async(e,t,n)=>{if(!n)return;const s=await l(t,n),r=s.pendingHearts.filter((t=>t!==e));await(0,a.t8)(o(t),{...s,pendingHearts:r,lastPending:r.length||s.pendingUnHearts.length||s.pendingGetAllItems?s.lastPending:i.lastPending},n)},L=async(e,t)=>{const n=await l(e,t);return Date.now()-n.lastPending<s?n.pendingUnHearts:i.pendingUnHearts},b=async(e,t,n)=>{if(!n)return;const i=await l(t,n);i.pendingUnHearts.includes(e)||await(0,a.t8)(o(t),{...i,pendingUnHearts:[...i.pendingUnHearts,e],lastPending:Date.now()},n)},x=async(e,t,n)=>{if(!n)return;const s=await l(t,n),r=s.pendingUnHearts.filter((t=>t!==e));await(0,a.t8)(o(t),{...s,pendingUnHearts:r,lastPending:r.length||s.pendingHearts.length||s.pendingGetAllItems?s.lastPending:i.lastPending},n)},P=async(e,t)=>{const n=await l(e,t);return n.pendingGetAllItems&&Date.now()-n.lastPending<s},v=async(e,t,n)=>{const s=await l(t,n);await(0,a.t8)(o(t),{...s,pendingGetAllItems:e,lastPending:e?Date.now():s.pendingUnHearts.length||s.pendingHearts.length?s.lastPending:i.lastPending},n)}},740017:function(e,t,n){n.d(t,{K:function(){return r}});var a=n(328804),i=n(339658),s=n(43020);const r=()=>{const e=(0,a.En)();return{...e,cid:e.cid||(0,i.a)(),idbStore:e.idbStore||(0,s.MT)()}}},575393:function(e,t,n){n.d(t,{IV:function(){return d},U2:function(){return r},t8:function(){return o},yh:function(){return a}});class a{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbp=new Promise(((n,a)=>{const i=indexedDB.open(e,1);i.onerror=()=>a(i.error),i.onsuccess=()=>n(i.result),i.onupgradeneeded=()=>{i.result.createObjectStore(t)}}))}_withIDBStore(e,t){return this._dbp.then((n=>new Promise(((a,i)=>{const s=n.transaction(this.storeName,e);s.oncomplete=()=>a(),s.onabort=s.onerror=()=>i(s.error),t(s.objectStore(this.storeName))}))))}}let i;function s(){return i||(i=new a),i}function r(e,t=s()){let n;return t._withIDBStore("readonly",(t=>{n=t.get(e)})).then((()=>n.result))}function o(e,t,n=s()){return n._withIDBStore("readwrite",(n=>{n.put(t,e)}))}function d(e,t=s()){return t._withIDBStore("readwrite",(t=>{t.delete(e)}))}}}]);